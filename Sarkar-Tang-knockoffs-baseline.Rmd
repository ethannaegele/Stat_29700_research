---
title: "Sarkar and Tang knockoffs baseline"
author: "Ethan Naegele"
date: "2024-05-07"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
knockoff_procedure <- function(X, Y, alpha = .05){
  # First, need to run create.fixed to get the knockoff matrix
  # Then, need to run the function stat.lasso_lambdasmax to generate the statistics
  # then, need to run knockoff.threshold to compute the knockoff threshold given the test statistics
  # Then, need to determine which variables to keep and which ones to exclude in the model (the ones above the threshold need to be kept in the model)
  
}
```



```{r}
run_knockoffs_simulation <- function(n, d, a, num_true_sigs, eta = .7, num_iter = 300){
  # Sets up the regression problem with specified dimensions and number of true signals, all of which have
  # the same amplitude. 
  # Runs the simulation by generating the regression problems and then runs fixed X knockoffs as described in Barber and Candes.
  
  
  fdp_vec <- numeric(num_iter)
pwr_vec <- c(num_iter)
for (m in 1:num_iter){
  feature_indices <- 1:d
  regression <- get_regression_model(n = n, d = d, a = a, num_true_signals = num_true_sigs)
  true_nonzero_indices <- regression$nonzero_indices
  rejected_indices <- sarkar_tang_method2(regression$X, regression$Y, alpha = .05, eta = eta)
  num_rejections <- length(rejected_indices)
  num_correct_rejections <- length(intersect(rejected_indices, true_nonzero_indices))
  num_false_rejections <- length(intersect(feature_indices[-true_nonzero_indices], rejected_indices))
  fdp_vec[m] <- num_false_rejections / max(num_rejections, 1)
  pwr_vec[m] <- num_correct_rejections / max(true_nonzero_indices, 1)
}
fdr <- mean(fdp_vec)
pwr <- mean(pwr_vec)
return(list(fdr = fdr, power = pwr))
}
```





